const { application, response, json } = require('express');
let http = require('http');
let url = require('url');
let XMLHttpRequest = require("xmlhttprequest").XMLHttpRequest;
const API_URL = "localhost:2601/api"
const xhr = new XMLHttpRequest();

function iniciar() {
    function onRequestHandler(){
        if (this.readyState === 4 && this.status === 200){
            //0=UNSET
            //1=OPENED
            //2=HEADERS_RECIVIED
            //3=LOADING
            //4=DONE
            console.log(this.response);
        }
        xhr.addEventListener("load", onRequestHandler);
        xhr.open("GET", `${API_URL}/cartes`);
        xhr.send();
            let partsURL = url.parse(request.url, true);
        let ruta = url.pparse(request.url, true).pathname;
        console.log('PeticiÃ³n para ' + partsURL.pathname + ' recibida');
        response.writeHead(200, {
            'Context-Type': 'text/plain; charset=utf-8'
        });

        fetch(`localhost:2601/api/cartes`)
            .then(response => response.json())
            .then(json => console.log(json))

    }

    http.createServer(onRequestHandler).listen(2601);
    console.log('Servidor iniciat')
}

exports.iniciar = iniciar;